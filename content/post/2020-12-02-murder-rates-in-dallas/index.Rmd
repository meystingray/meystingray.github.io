---
title: Murder Rates in Dallas
author: Sean Conroy
date: '2020-12-02'
slug: murder-rates-in-dallas
categories:
  - Dallas-Police-Data
tags: []
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)
library(RSocrata)
library(data.table)
library(ggplot2)

```

## Dallas Murder Rate

Based on the following data set from Dallas Open Data: <https://www.dallasopendata.com/Public-Safety/Police-Incidents/qv6i-rri7>
    
    
Data refresh date:
```{r printDate, echo = FALSE}
print(Sys.Date())
```

Load data directly from DallasOpenData using Socrata API:
```{r LoadData, echo = TRUE}

#PI <- read.socrata("https://www.dallasopendata.com/resource/qv6i-rri7.csv")
#PI <- readRDS("C:/Users/sconroy/Desktop/Debug/PoliceIncidents.RDS")
#setDT(PI)

```


First, let's extract murder incidents by looking for "MURDER" or "HOMICIDE" in the officer's incident description.
```{r Extract Murders, echo = TRUE}
Murder <- readRDS("C:/Users/sconroy/Desktop/Debug/Murder.RDS")
#Murder <- PI[grepl("MURDER",offincident) | grepl("HOMICIDE",offincident),]
Murder[,Date := as.Date(substr(date1,1,10))]

# Add Dates and Incidents / Day & Month counts 
Murder[,MonthDate := as.Date(paste0(format(Date,"%Y-%m"),"-01"))]
Murder[,WeekNum := strftime(Date, format = "%V")]
Murder <- merge(Murder,Murder[,head(.SD, 1L),.SDcols = "Date",by = c("servyr","WeekNum")],by = c("servyr","WeekNum"))
setnames(Murder,old = c("Date.x","Date.y"),new = c("Date","WeekDate"))

setorder(Murder,Date)

Murder[,NumPerDay := .N,by = Date]
Murder[,NumPerWeek := .N,by = WeekDate]
Murder[,NumPerMonth := .N,by = MonthDate]

```


First let's smooth the rates per day, week, month...
```{r Smooth Data, echo = TRUE}
# Smooth Murder Rates for plotting
Murder[,SmoothNumPerDay := predict(smooth.spline(NumPerDay,df = 20))$y]
Murder[,SmoothNumPerWeek := predict(smooth.spline(NumPerWeek,df = 55))$y]
Murder[,SmoothNumPerMonth := predict(smooth.spline(NumPerMonth,df = 10))$y]


```


Now let's take a look at Murder Rates per Month over the last few years.
``` {r Monthly Murder Rate, echo = TRUE}
ggplot(Murder) +
    geom_line(aes(x = MonthDate,y = SmoothNumPerMonth,color = "red")) + 
    geom_point(data = Murder,aes(x = Date,y = NumPerMonth)) + 
    geom_line(aes(x = Date,y = SmoothNumPerDay,color = "blue")) +
    ggtitle("Murder Rates") + ylab("# Murders") + 
    scale_colour_manual(name = '',values = c('blue'='blue','red'='red'),
                        labels = c('Per Day','Per Month'))

```
Yes - it definitely looks like there's an uptick in the last few months of 2020!

Let's take a look at the same data, but bin it by week instead of month:
```{r Weekly Murder Rate, echo = TRUE}
ggplot(Murder) +
    geom_point(aes(x = WeekDate,y = NumPerWeek)) + 
    geom_line(aes(x = WeekDate,y = SmoothNumPerWeek),color = "red") +
    ggtitle("Murder Rates per Week") + ylab("# Murders")
```

The rates look even worse when binned by week - because a few incidents were concentrated?

```{r Recent Murder Rate, echo = TRUE}
ggplot(Murder[Date >= as.Date("2020-06-01"),]) +
    geom_point(aes(x = Date,y = NumPerDay)) + 
    geom_line(aes(x = WeekDate,y = SmoothNumPerDay),color = "red") +
    ggtitle("Murder Rates per Day") + ylab("# Murders")
```

It looks like there's been several days of 3 murders/day recently, which is the spike in the weekly chart.

Let's look at just 2020
```{r BarPlot Murder Rate 2020 Only, echo=TRUE}
ggplot(Murder[Date > as.Date("2020-01-01"),],aes(x = MonthDate)) + geom_bar() +
    ylab("# Murders per Month") + ggtitle("2020 Murders Per Month") +
    geom_text(aes(x = MonthDate,y = NumPerMonth,label = NumPerMonth),vjust = -0.25)
```